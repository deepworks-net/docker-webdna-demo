[!] ============================= [/!]
[!] 	    Create Variables	  [/!]
[!] ============================= [/!]
[Function name=OCB_DeclareVars]
	[text]del=|[/text]
	[Hideif [delimiters]=]
		[Hideif [delimiters]=[RAW][delimiters][/RAW]]
			[text]del=[delimiters][/text]
		[/Hideif]
	[/Hideif]
	[Listwords words=[vars]&delimiters=[del]]
		[text scope=global][word][/text]
	[/Listwords]
[/Function]

[!] ============================= [/!]
[!] 	  Create Variables 2	  [/!]
[!] ============================= [/!]
[Function name=OCB_DeclareVars2]
	[text scope=global&multi=T][vars][/text]
[/Function]

[!] ============================= [/!]
[!] Encrypts a String with Base64 [/!]
[!] ============================= [/!]
[Function name=OCB_EncryptIt]
	[RETURN][URL][URL][Encrypt method=Base64][string][/Encrypt][/URL][/URL][/RETURN]
[/Function]

[!] ============================= [/!]
[!] Decrypts a String with Base64 [/!]
[!] ============================= [/!]
[Function name=OCB_DecryptIt]
	[RETURN][Decrypt method=Base64][UNURL][UNURL][string][/UNURL][/UNURL][/Decrypt][/RETURN]
[/Function]

[!] ============================= [/!]
[!]  Constructs a default header  [/!]
[!] ============================= [/!]
[Function name=OCB_MakeHeader]
	[text multi=T]_typ=DNA&_alg=APOP[/text]
	[Hideif [typ]=]
		[Hideif [typ]=[RAW][typ][/RAW]]
			[text]_typ=[typ][/text]
		[/Hideif]
	[/Hideif]
	[Hideif [alg]=]
		[Hideif [alg]=[RAW][alg][/RAW]]
			[text]_alg=[alg][/text]
		[/Hideif]
	[/Hideif]
	[RETURN][URL]|alg=[_alg]|typ=[_typ]|[/URL][/RETURN]
[/Function]

[!] ============================= [/!]
[!]  Constructs a default header2 [/!]
[!] ============================= [/!]
[Function name=OCB_MakeHeader2]
	[text multi=T]_typ=DNA&_alg=APOP[/text]
	[Hideif [typ]=]
		[Hideif [typ]=[RAW][typ][/RAW]]
			[text]_typ=[typ][/text]
		[/Hideif]
	[/Hideif]
	[Hideif [alg]=]
		[Hideif [alg]=[RAW][alg][/RAW]]
			[text]_alg=[alg][/text]
		[/Hideif]
	[/Hideif]
	[RETURN][URL]alg=[_alg]&typ=[_typ][/URL][/RETURN]
[/Function]

[!] ============================= [/!]
[!]  	Constructs a Signature    [/!]
[!] ============================= [/!]
[Function name=OCB_MakeSignature]
	[RETURN][URL][URL][Encrypt method=[method][Hideif [method]=Base64]&key=[key][/Hideif]][token][/Encrypt][/URL][/URL][/RETURN]
[/Function]

[Function name=OCB_PrintToken]
	[Listwords words=[token]&delimiters=.]
		[Showif [index]=1]
			pheader = [word]<br>
		[/Showif]
		[Showif [index]=2]
			ppayload = [word]<br>
		[/Showif]
		[Showif [index]=3]
			psignature = [word]<br>
		[/Showif]
	[/Listwords]
[/Function]

[!] ============================= [/!]
[!]  	  Compares 2 Strings      [/!]
[!] ============================= [/!]
[Function name=OCB_Compare]
	[Switch value=[Value1]]
		[Case value=[Value2]]
			[RETURN]T[/RETURN]
		[/Case]
		[Default]
			[RETURN]F[/RETURN]
		[/Default]
	[/Switch]
[/Function]

[!] ============================= [/!]
[!]  	     Makes a Token        [/!]
[!] ============================= [/!]
[Function name=OCB_IssueToken]
	[!] ==========Move to Global Var? =========== [/!]
	[text multi=T]_typ=DNA&_alg=APOP[/text]
	[Hideif [alg]=]
		[Hideif [alg]=[RAW][alg][/RAW]]
			[text]_alg=[alg][/text]
		[/Hideif]
	[/Hideif]
	[Hideif [typ]=]
		[Hideif [typ]=[RAW][typ][/RAW]]
			[text]_typ=[typ][/text]
		[/Hideif]
	[/Hideif]
	ALG = [_alg]<br>
	encHeader = [text show=t]encHeader=[OCB_EncryptIt string=[URL][OCB_MakeHeader typ=[_typ]&alg=[_alg]][/URL]][/text]<br>
	encPayload = [text show=t]encPayload=[OCB_EncryptIt string=[URL][payload][/URL]][/text]</br>
	top = [text show=t]top=[encHeader].[encPayload][/text]</br>
	signature = [text show=t]signature=[OCB_MakeSignature method=APOP&key=[key]&token=[URL][top][/URL]][/text]</br>
	token = [text show=t]token=[top].[OCB_EncryptIt string=[URL][signature][/URL]][/text]<br>
	Test = [text show=t]test=[/text]<br>
	[RETURN][URL][token][/URL][/RETURN]<br>
[/Function]

[Function name=OCB_VerifyToken]
	[text multi=t]result=F&pheader=&ppayload=&psignature=[/text]
	[URL][token][/URL]<br>
	[Listwords words=[URL][URL][token][/URL][/URL]&delimiters=.]
		[Showif [index]=1]
			pheader = [text show=t]pheader=[word][/text]<br>
		[/Showif]
		[Showif [index]=2]
			ppayload = [text show=t]ppayload=[word][/text]<br>
		[/Showif]
		[Showif [index]=3]
			psignature = [text show=t]psignature=[word][/text]<br>
		[/Showif]
	[/Listwords]
	[Showif [pheader]!]
		top = [text show=t]top=[pheader].[ppayload][/text]<br>
		[OCB_DeclareVars vars=[OCB_DecryptIt string=[URL][pheader][/URL]]]
		[OCB_DeclareVars vars=[OCB_DecryptIt string=[URL][ppayload][/URL]]]
		sig = [text show=t]sig=[OCB_MakeSignature method=APOP&key=[key]&token=[URL][top][/URL]][/text]</br>
		[Showif [OCB_DecryptIt string=[URL][psignature][/URL]]=[sig]]
			[text]result=T[/text]
		[/Showif]
	[/Showif]
	[RETURN][result][/RETURN]
	[!][result][/!]
[/Function]

[Function name=OCB_AuthenticateCookie]
	[text]res=F[/text]
	[Showif [OCB_VerifyToken token=[URL][GETCOOKIE name=[cookie]][/URL]&key=[key]]=T]
		[text]res=T[/text]
	[/Showif]
	[RETURN][res][/RETURN]
[/Function]
